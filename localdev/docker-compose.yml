### Autogenerated - DO NOT EDIT
version: '2.4'

#
# Do not try to run this manually. This is meant to be run using the runLocal.sh script in the root of the project.
# Also do not edit docker-compose.yml as it is autogenerated.
# If you make any changes to this file remember to run "./runLocal.sh refresh".
#

#
# Network definitions
#
networks:
  demoapp:


services:
  #
  # Database
  #
  postgresql-server:
    image: postgres:14-alpine
    container_name: demoapp-postgresql-server
    ports:
      - "5432:5432"
    environment:
      - "POSTGRES_PASSWORD=7b1c3deda5144f99a6973f462215b8cd"
    volumes:
      - ./app-config/postgresql-initdb.d:/docker-entrypoint-initdb.d:ro
    networks:
      - demoapp

  #
  # Redis
  #
  redis-server:
    image: redis:6-alpine
    container_name: demoapp-redis-server
    ports:
      - "6379:6379"
    networks:
      - demoapp

  #
  # pgweb (simple ui for postgresql)
  #
  pgweb:
    image: sosedoff/pgweb
    container_name: demoapp-pgweb
    restart: always
    ports:
      - "54321:8081"
    environment:
      - "DATABASE_URL=postgres://postgres:7b1c3deda5144f99a6973f462215b8cd@postgresql-server:5432/postgres?sslmode=disable"
    links:
      - postgresql-server:postgresql-server
    depends_on:
      - postgresql-server
    networks:
      - demoapp

  #
  # template-service
  # If you make any changes to this file remember to run "./runLocal.sh refresh".
  #
  template-service:
    image: eclipse-temurin:17-jre-alpine
    container_name: demoapp-template-service
    command: sh /setup/run-jar template-service.jar postgresql-server:5432 redis-server:6379
    ports:
      - "4000:4000"
      - "8080:8080"
    environment:
      - "JAVA_DEBUG=${JAVA_DEBUG}"
      - "SPRING_PROFILES_ACTIVE=local"
      - "SPRING_DATASOURCE_URL=jdbc:postgresql://postgresql-server/template"
      - "SPRING_DATASOURCE_USERNAME=template"
      - "SPRING_DATASOURCE_PASSWORD=pg12345"
      - "SPRING_REDIS_HOST=redis-server"
      - "SPRING_REDIS_PORT=6379"
    volumes:
      - ./.deploy/template-service.jar:/code/template-service.jar:ro
      - ./scripts/alpine/:/setup/:ro
    links:
      - postgresql-server
      - redis-server
    depends_on:
      - postgresql-server
      - redis-server
    networks:
      - demoapp
